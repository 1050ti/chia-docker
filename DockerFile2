FROM ubuntu:focal

WORKDIR /app

RUN apt-get update && apt-get install -y \
  build-essential \
  python3.8 python3.8-distutils python3.8-venv python3-pip

# chia install - doesn't work with the tar.gz
# LookupError: setuptools-scm was unable to detect version for '/app/chia-blockchain'
# RUN apt-get install -y curl
# RUN curl -L https://github.com/Chia-Network/chia-blockchain/archive/1.0rc5.tar.gz \
#  | tar -xzC . && \
#  mv chia-blockchain-1.0rc5 chia-blockchain

RUN apt-get install -y git
RUN git clone https://github.com/Chia-Network/chia-blockchain --depth 3


ENV VIRTUAL_ENV=/app/venv
RUN python3 -m venv $VIRTUAL_ENV
ENV PATH="${VIRTUAL_ENV}/bin:$PATH"

RUN cd chia-blockchain && \
  pip install --upgrade pip && \
  pip install wheel \
  pip install --extra-index-url https://download.chia.net/simple/ miniupnpc==2.1 && \
  pip install -e . --extra-index-url https://download.chia.net/simple/
